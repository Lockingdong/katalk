(function(t){function e(e){for(var n,r,o=e[0],c=e[1],u=e[2],f=0,d=[];f<o.length;f++)r=o[f],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&d.push(i[r][0]),i[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(d.length)d.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],n=!0,o=1;o<s.length;o++){var c=s[o];0!==i[c]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=s[0]))}return t}var n={},i={app:0},a=[];function r(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=n,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var l=c;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"16a3":function(t,e,s){"use strict";s("cd8c")},"26d9":function(t,e,s){"use strict";s("420b")},"420b":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var n=s("2b0e"),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("Adsense",{attrs:{"data-ad-client":"ca-pub-5005950761451963","data-ad-slot":"5777063646","data-full-width-responsive":"true"}}),s("transition",{attrs:{name:"fade"}},[t.navOpen?s("navbar",{attrs:{muted:t.muted},on:{"toggle-muted":t.toggleMuted,"close-navbar":function(e){t.navOpen=!1}}}):t._e()],1),s("div",{staticClass:"ham",on:{click:function(e){t.navOpen=!t.navOpen}}},[s("span",{staticClass:"line1"}),s("span",{staticClass:"line2"})]),s("transition",{attrs:{name:"fade"}},[t.currentPageStatus===t.pageStatus.init?s("landing-page",{attrs:{"show-join-button":t.showJoinButton},on:{"join-room":t.joinRoom}}):t._e(),t.currentPageStatus===t.pageStatus.wait?s("waiting-page"):t._e(),t.currentPageStatus===t.pageStatus.inroom?s("chat-room",{attrs:{msgs:t.msgs,"is-other-typing":t.isOtherTyping},on:{"send-msg":t.sendMsg,"leave-room":t.leaveRoom,"user-is-typing":t.userIsTyping}}):t._e()],1)],1)},a=[],r=s("3835"),o=(s("159b"),s("ac1f"),s("1276"),s("d4ec")),c=function t(e,s){Object(o["a"])(this,t),this.className=e,this.content=s},u=c,l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-room-wrapper"},[s("div",{ref:"msgList",staticClass:"msg-list-wrapper"},[s("transition-group",{staticClass:"msg-list",attrs:{name:"list",tag:"ul"}},[t._l(t.msgs,(function(e,n){return s("li",{key:"msg"+n,staticClass:"msg-item",class:t.msgItem(e.className,n)},["admin"===e.className?s("div",{staticClass:"msg-wrapper",domProps:{innerHTML:t._s(e.content)}}):s("div",{staticClass:"msg-wrapper"},[t._v(" "+t._s(e.content)+" ")])])})),t.isOtherTyping?s("li",{key:"other_typing",staticClass:"msg-item other"},[s("div",{staticClass:"msg-wrapper"},[t._v(" 對方正在輸入... ")])]):t._e()],2)],1),s("div",{staticClass:"text-form"},[s("div",{staticClass:"hist-msg-list"},[s("ul",t._l(t.histMsgArr,(function(e,n){return s("li",{key:n,on:{click:function(s){return t.triggerInput(e)}}},[t._v(t._s(e))])})),0)]),s("div",{staticClass:"form-wrapper"},[s("div",{staticClass:"form-btn leave",on:{click:t.showLeaveRoomForm}},[s("i",{staticClass:"fas fa-sign-out-alt"})]),s("div",{staticClass:"text-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.userMsg,expression:"userMsg"}],ref:"textInput",staticClass:"text-msg",attrs:{type:"text",disabled:t.userMsgFormDisabled},domProps:{value:t.userMsg},on:{keydown:t.sendMsgHandler,input:function(e){e.target.composing||(t.userMsg=e.target.value)}}})]),s("div",{staticClass:"form-btn",on:{click:t.sendMsg}},[s("i",{staticClass:"fas fa-paper-plane"})])])]),s("confirm-form",{on:{confirm:t.leaveRoom}})],1)},f=[],d=s("ade3"),g=(s("498a"),s("caad"),s("2532"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("modal",{attrs:{name:"confirm-form","max-width":600,width:"90%",height:"auto",adaptive:!0},on:{"before-open":t.beforeOpen}},[s("div",{staticClass:"card-body"},[s("h4",{staticClass:"mb-3 text-center"},[t._v(t._s(t.header))]),t.isContentArray?s("div",{staticClass:"text-center mb-3"},[s("ul",t._l(t.content,(function(e,n){return s("li",{key:n},[t._v(" "+t._s(e)+" ")])})),0)]):s("div",{staticClass:"text-center mb-3",domProps:{innerHTML:t._s(t.content)}}),s("div",{staticClass:"text-center"},[s("button",{staticClass:"btn btn-outline-secondary me-3",on:{click:t.cancel}},[t._v("取消")]),s("button",{staticClass:"btn btn-primary",on:{click:t.confirm}},[t._v("確定")])])])])}),h=[],m={data:function(){return{header:{type:String,required:!0},content:{required:!0}}},computed:{isContentArray:function(){return Array.isArray(this.content)}},methods:{close:function(){this.$modal.hide("confirm-form")},beforeOpen:function(t){var e=t.params;this.header=e.header||"",this.content=e.content||""},confirm:function(){this.$emit("confirm"),this.close()},cancel:function(){this.$emit("cancel"),this.close()}}},p=m,v=(s("8932"),s("2877")),_=Object(v["a"])(p,g,h,!1,null,"39f5b1ae",null),b=_.exports,S={data:function(){return{userMsg:"",userMsgFormDisabled:!1,histMsgArr:[]}},components:{ConfirmForm:b},props:{msgs:{type:Array,required:!0},isOtherTyping:{type:Boolean,required:!0}},computed:{userMsgHasValue:function(){return""!==this.userMsg}},methods:{sendMsgHandler:function(t){13!==t.keyCode||t.shiftKey||(t.preventDefault(),this.sendMsg())},sendMsg:function(){var t=this.userMsg.trim();if(""!==t&&!this.userMsgFormDisabled){var e=this.filterMsg(t,200);this.pushInHistMsg(e),this.$emit("send-msg",e),this.userMsg="",this.lockUserMsgForm()}},filterMsg:function(t,e){var s=t;return s.length>e?(s=s.substring(0,e),s+"..."):s},pushInHistMsg:function(t){var e=this.$localStorage.get("hms"),s=JSON.parse(e);t.length<=5&&!s.includes(t)&&(s.unshift(t),s.length>=6&&s.pop()),this.$localStorage.set("hms",JSON.stringify(s)),this.histMsgArr=s},showLeaveRoomForm:function(){this.$modal.show("confirm-form",{header:"確定要離開嗎？",content:"離開後訊息將無法還原"})},leaveRoom:function(){this.$emit("leave-room")},msgItem:function(t,e){var s;return s={},Object(d["a"])(s,t,!0),Object(d["a"])(s,"last",void 0===this.msgs[e+1]||this.msgs[e+1].className!==t),s},msgListScrollDown:function(){var t=this;this.$nextTick((function(){var e=t.$refs.msgList;e.scrollTop=e.scrollHeight}))},triggerInput:function(t){this.userMsg=t,this.$refs.textInput.focus()},lockUserMsgForm:function(){var t=this;this.userMsgFormDisabled=!0,setTimeout((function(){t.userMsgFormDisabled=!1,t.$nextTick((function(){t.$refs.textInput.focus()}))}),800)}},watch:{userMsgHasValue:function(t,e){this.$emit("user-is-typing",t)},isOtherTyping:function(t,e){t&&this.msgListScrollDown()},msgs:function(){this.msgListScrollDown()}},mounted:function(){this.msgListScrollDown(),this.histMsgArr=JSON.parse(this.$localStorage.get("hms"))}},O=S,M=(s("5fcf"),Object(v["a"])(O,l,f,!1,null,null,null)),w=M.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"landing-page"},[t._m(0),s("h1",{staticClass:"title"},[t._v("聊BAR")]),s("h3",{staticClass:"subtitle"},[t._v("來聊BAR聊吧")]),s("transition",{attrs:{name:"fade"}},[t.showJoinButton?s("button",{staticClass:"start-btn",on:{click:t.joinRoom}},[t._v("進入包廂")]):t._e()])],1)},C=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"logo-wrapper"},[n("img",{attrs:{src:s("ad2f"),alt:""}})])}],T={props:{showJoinButton:{type:Boolean,required:!0}},methods:{joinRoom:function(){this.$emit("join-room")}}},$=T,k=(s("f1b9"),Object(v["a"])($,y,C,!1,null,null,null)),R=k.exports,I=s("c4b6"),E=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"navbar",on:{click:function(e){return e.target!==e.currentTarget?null:t.closeNavbar.apply(null,arguments)}}},[s("div",{staticClass:"nav-content"},[t._m(0),s("ul",[s("li",[t._v("關於聊Bar")]),s("li",[t._v("服務條款")]),s("li",[t._v("尋人專區")]),s("li",{staticClass:"mute"},[t._v(" 通知音效 "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.navMuted,expression:"navMuted"}],attrs:{type:"checkbox",id:"switch"},domProps:{checked:Array.isArray(t.navMuted)?t._i(t.navMuted,null)>-1:t.navMuted},on:{change:function(e){var s=t.navMuted,n=e.target,i=!!n.checked;if(Array.isArray(s)){var a=null,r=t._i(s,a);n.checked?r<0&&(t.navMuted=s.concat([a])):r>-1&&(t.navMuted=s.slice(0,r).concat(s.slice(r+1)))}else t.navMuted=i}}}),s("label",{attrs:{for:"switch"}},[t._v("Toggle")])]),t._m(1)]),t._m(2)])])},N=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"logo-wrapper"},[n("img",{attrs:{src:s("ad2f"),alt:""}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("i",{staticClass:"fas fa-donate"}),t._v(" 贊助開發APP基金")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"media"},[s("a",{attrs:{href:"https://www.facebook.com/talkbartalk/",target:"_blank"}},[s("i",{staticClass:"fab fa-facebook"})]),s("a",{attrs:{href:"https://www.instagram.com/talkbartalk/",target:"_blank"}},[s("i",{staticClass:"fab fa-instagram"})])])}],x={props:{muted:{type:Boolean,required:!0}},methods:{closeNavbar:function(){this.$emit("close-navbar",!1)}},computed:{navMuted:{get:function(){return!this.muted},set:function(t){this.$emit("toggle-muted")}}}},A=x,P=(s("16a3"),Object(v["a"])(A,E,N,!1,null,null,null)),j=P.exports,U=(s("cc98"),s("a4da")),J=s.n(U),L={name:"App",components:{ChatRoom:w,LandingPage:R,WaitingPage:I["default"],Navbar:j},data:function(){return{msgs:[],pageStatus:{init:"INIT",wait:"WAIT",inroom:"INROOM"},currentPageStatus:"",isOtherTyping:!1,navOpen:!1,muted:!0,notificationCount:0,showJoinButton:!1,docTitle:""}},sockets:{connect:function(){var t=this.$localStorage.get("ri");if("WAITING_ROOM"===t)return this.leaveRoom(),void(this.showJoinButton=!0);null===t?this.showJoinButton=!0:this.$socket.emit("USER_RECONNECT_CHAT_ROOM",t,this.$localStorage.get("ut"))},USER_CLEAR_ROOM:function(){this.resetToInit()},JOIN_CHAT_ROOM_SUCCESS:function(t){this.$localStorage.set("ri",t),this.currentPageStatus=this.pageStatus.inroom},JOIN_WAITING_ROOM:function(){this.$localStorage.set("ri","WAITING_ROOM"),this.currentPageStatus=this.pageStatus.wait},USER_RECONNECT_CHAT_ROOM:function(){this.currentPageStatus=this.pageStatus.inroom},USER_RECONNECT_WAITING_ROOM:function(){this.currentPageStatus=this.pageStatus.wait},USER_RECV_MSG:function(t){var e=Object(r["a"])(t,2),s=e[0],n=e[1];this.addNotification(),this.insertMsgToWindow(s,n),0!==s&&this.alertSound()},USER_SET_HIST_MSGS:function(t){var e=this;t.forEach((function(t){var s=JSON.parse(t),n=Object(r["a"])(s,2),i=n[0],a=n[1];e.insertMsgToWindow(i,a)}))},OTHER_IS_TYPING:function(t){this.isOtherTyping=t}},computed:{},watch:{notificationCount:function(t,e){document.title=1===t?"(🔔) ".concat(this.docTitle):this.docTitle}},methods:{getUserOrder:function(){var t=this.$localStorage.get("ut"),e=this.$localStorage.get("ri"),s=e.split(":");return t===s[0]?1:2},joinRoom:function(){this.$socket.emit("USER_CLICK_JOIN_ROOM",this.$localStorage.get("ut"))},leaveRoom:function(){this.$socket.emit("USER_CLICK_LEAVE_ROOM",this.$localStorage.get("ri"),this.$localStorage.get("ut")),this.resetToInit()},sendMsg:function(t){var e=this.getUserOrder();this.insertMsgToWindow(e,t),this.emitUserMsg(e,t)},emitUserMsg:function(t,e){this.$socket.emit("USER_SEND_MSG",this.$localStorage.get("ri"),t,e)},insertMsgToWindow:function(t,e){var s,n=this.getUserOrder();t===n?s="mine":0===t?s="admin":t!==n?s="other":console.log("user order not found");var i=new u(s,e);this.msgs.push(i)},resetToInit:function(){this.$localStorage.remove("ri"),this.currentPageStatus=this.pageStatus.init,this.msgs=[],this.isOtherTyping=!1,this.showJoinButton=!0},userIsTyping:function(t){this.resetNotification(),this.$socket.emit("USER_IS_TYPING",this.$localStorage.get("ri"),t)},toggleMuted:function(){this.muted=!this.muted},addNotification:function(){this.notificationCount=1},resetNotification:function(){this.notificationCount=0},alertSound:function(){if(!this.muted){var t=new Audio(J.a);t.play()}}},mounted:function(){this.currentPageStatus=this.pageStatus.init,this.docTitle=document.title;var t=window.innerHeight/100;document.querySelector("#app").style.setProperty("--vh",t+"px"),window.addEventListener("resize",(function(){document.querySelector("#app").style.setProperty("--vh",t+"px")}))}},H=L,B=(s("5c0b"),Object(v["a"])(H,i,a,!1,null,null,null)),D=B.exports,F=s("5132"),W=s.n(F),q=s("8e27"),G=s.n(q),V=s("ead5"),K=s.n(V),Y=s("1881"),z=s.n(Y),Q=s("ec26"),X=s("119b");n["a"].use(s("395c")),n["a"].use(X["a"].Adsense),n["a"].use(X["a"].InArticleAdsense),n["a"].use(X["a"].InFeedAdsense),n["a"].use(K.a),n["a"].use(z.a);var Z=n["a"].localStorage.get("ut");null===Z&&(Z=Object(Q["a"])(),n["a"].localStorage.set("ut",Z));var tt=n["a"].localStorage.get("hms");null===tt&&n["a"].localStorage.set("hms",JSON.stringify([]));var et=G()("https://talkbar.fun",{query:{user_token:Z}});n["a"].use(new W.a({debug:!0,connection:et})),n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(D)}}).$mount("#app")},"5c0b":function(t,e,s){"use strict";s("9c0c")},"5fcf":function(t,e,s){"use strict";s("9b40")},"79ef":function(t,e,s){},8932:function(t,e,s){"use strict";s("dca1")},9603:function(t,e,s){"use strict";var n=s("c618"),i=s.n(n);e["default"]=i.a},"9b40":function(t,e,s){},"9c0c":function(t,e,s){},a4da:function(t,e,s){t.exports=s.p+"media/alert.1de6c75d.mp3"},ad2f:function(t,e,s){t.exports=s.p+"img/bar.834b265b.png"},af67:function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"waiting-page"},[t._v(" 正在排隊進入包廂 ... ")])},i=[]},c4b6:function(t,e,s){"use strict";var n=s("af67"),i=s("9603"),a=(s("26d9"),s("2877")),r=Object(a["a"])(i["default"],n["a"],n["b"],!1,null,null,null);e["default"]=r.exports},c618:function(t,e){},cd8c:function(t,e,s){},dca1:function(t,e,s){},f1b9:function(t,e,s){"use strict";s("79ef")}});
//# sourceMappingURL=app.2631073b.js.map